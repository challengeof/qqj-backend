<!DOCTYPE html>  
<html>  
<head>  
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />  
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />  
<style type="text/css">  
body, html,#l-map {width: 100%;height: 100%;overflow: hidden;margin:0;}  
</style>  
<script type="text/javascript" src="http://api.map.baidu.com/api?ak=1507703fda1fb9594c7e7199da8c41d8&v=2.0"></script>
<script src="http://lib.sinaapp.com/js/jquery/1.7.2/jquery.min.js"></script>
<title>显示地图</title>  
</head>  
<body>  
<div id="l-map"></div>  
</body>
</html>  
<script type="text/javascript">  
function addMarker(map, restaurant) {
	if (restaurant.address.wgs84Point) {
		
	 var lon = restaurant.address.wgs84Point.longitude;
     var lat = restaurant.address.wgs84Point.latitude;
     var name = restaurant.name;
	
        // 自定义覆盖物标签
        function ComplexCustomOverlay(point, text){
          this._point = point;
          this._text = text;
        }
        ComplexCustomOverlay.prototype = new BMap.Overlay();
        ComplexCustomOverlay.prototype.initialize = function(map){
          this._map = map;
          var div = this._div = document.createElement("div");
          div.style.position = "absolute";
          div.style.zIndex = BMap.Overlay.getZIndex(this._point.lat);
          div.style.backgroundColor = "white";
          div.style.border = "1px solid red";
          div.style.color = "red";
          div.style.height = "20px";
          div.style.padding = "0px";
          div.style.lineHeight = "20px";
          div.style.whiteSpace = "nowrap";
          div.style.fontSize = "12px"
          var span = this._span = document.createElement("span");
          div.appendChild(span);
          span.appendChild(document.createTextNode(this._text));      

          var arrow = this._arrow = document.createElement("div");     
          arrow.style.position = "absolute";
          arrow.style.width = "11px";
          arrow.style.height = "10px";
          arrow.style.top = "22px";
          arrow.style.left = "10px";
          arrow.style.overflow = "hidden";
          div.appendChild(arrow);

          map.getPanes().labelPane.appendChild(div);
          
          return div;
        }

        ComplexCustomOverlay.prototype.draw = function(){
          var map = this._map;
          var pixel = map.pointToOverlayPixel(this._point);
          this._div.style.left = pixel.x + 10 + "px";
          this._div.style.top  = pixel.y - 22 + "px";
        }

        var myCompOverlay = new ComplexCustomOverlay(new BMap.Point(lon, lat), name);

        map.addOverlay(myCompOverlay);

        var point = new BMap.Point(lon, lat);
        var marker = new BMap.Marker(point);

        map.addOverlay(marker);
		
	}
};

function getUrlVars(str)
{
    var vars = [];
    var url = decodeURIComponent(window.location.href);
    var hashes = url.slice(url.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
        hash = hashes[i].split('=');
        if(hash[1] != '' && hash[0] == str){
        	vars.push(hash[1].split(","));
        }
    }
    return vars;
}

var map = new BMap.Map("l-map");  
map.centerAndZoom(new BMap.Point(116.316173, 40.058142), 12); 

var all =  getUrlVars("points");
var hash = getUrlVars("hash");
if(all != '') {
	$.ajax({
		type : 'get',
		url:'/admin/api/restaurant/map?restaurantId=' + all + '&hash=' + hash[0],  
        dataType:'json',  
        success:function(data){
        	for (var i = 0; i < data.length; i++) {
                addMarker(map, data[i]);
            }
        }  
	});
}
</script>