15:23:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant add constraint FK_9xujac7ov11xmaijj1y43ypq7 foreign key (type_id) references restaurant_type (id)
15:23:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:23:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant_type add constraint FK_7jxspfd0tyuhs68nc15gp2qdb foreign key (parent_id) references restaurant_type (id)
15:23:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:23:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant_type_city_xref add constraint FK_c2nechb3ltahd2705tdmjjpwu foreign key (restaurant_type_id) references restaurant_type (id)
15:23:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:23:14 [main] INFO  c.m.cgwy.message.MessageConsumer - Application started successfully.
15:26:48 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant add constraint FK_9xujac7ov11xmaijj1y43ypq7 foreign key (type_id) references restaurant_type (id)
15:26:48 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:26:48 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant_type add constraint FK_7jxspfd0tyuhs68nc15gp2qdb foreign key (parent_id) references restaurant_type (id)
15:26:48 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:26:48 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant_type_city_xref add constraint FK_c2nechb3ltahd2705tdmjjpwu foreign key (restaurant_type_id) references restaurant_type (id)
15:26:48 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:26:54 [main] INFO  c.m.cgwy.message.MessageConsumer - Application started successfully.
15:37:19 [defaultCouponMessageJmsContainer-1] INFO  c.m.c.m.PromotionMessageListener - cost: 1130ms promotionMessage: PromotionMessage(cityId=null, warehouseId=null, restaurantId=null, customerId=null, orderId=null, promotionType=null, couponId=null, couponSenderEnum=GATHERING_COMPLETED_SEND, stockOutIds=[55113])
15:46:34 [ActiveMQ Connection Executor: tcp:///127.0.0.1:61616@62234] WARN  o.s.j.c.CachingConnectionFactory - Encountered a JMSException - resetting the underlying JMS Connection
javax.jms.JMSException: java.io.EOFException
	at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:54) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.ActiveMQConnection.onAsyncException(ActiveMQConnection.java:1998) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.ActiveMQConnection.onException(ActiveMQConnection.java:2017) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.transport.TransportFilter.onException(TransportFilter.java:101) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.transport.ResponseCorrelator.onException(ResponseCorrelator.java:126) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.transport.TransportFilter.onException(TransportFilter.java:101) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.transport.TransportFilter.onException(TransportFilter.java:101) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.transport.WireFormatNegotiator.onException(WireFormatNegotiator.java:160) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.transport.TransportSupport.onException(TransportSupport.java:96) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:200) ~[activemq-client-5.10.0.jar:5.10.0]
	at java.lang.Thread.run(Thread.java:745) [na:1.8.0_40]
Caused by: java.io.EOFException: null
	at java.io.DataInputStream.readInt(DataInputStream.java:392) ~[na:1.8.0_40]
	at org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:258) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:221) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:213) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196) ~[activemq-client-5.10.0.jar:5.10.0]
	... 1 common frames omitted
15:46:34 [activityCouponMessageJmsContainer-1] WARN  o.s.j.l.DefaultMessageListenerContainer - Setup of JMS message listener invoker failed for destination 'queue://activityCouponMessageQueue' - trying to recover. Cause: The Consumer is closed
15:46:34 [scoreMessageJmsContainer-1] WARN  o.s.j.l.DefaultMessageListenerContainer - Execution of JMS message listener failed, and no ErrorHandler has been set.
javax.jms.IllegalStateException: The Session is closed
	at org.apache.activemq.ActiveMQSession.checkClosed(ActiveMQSession.java:767) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.ActiveMQSession.getTransacted(ActiveMQSession.java:532) ~[activemq-client-5.10.0.jar:5.10.0]
	at sun.reflect.GeneratedMethodAccessor31.invoke(Unknown Source) ~[na:na]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_40]
	at java.lang.reflect.Method.invoke(Method.java:497) ~[na:1.8.0_40]
	at org.springframework.jms.connection.CachingConnectionFactory$CachedSessionInvocationHandler.invoke(CachingConnectionFactory.java:384) ~[spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at com.sun.proxy.$Proxy153.getTransacted(Unknown Source) ~[na:na]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.commitIfNecessary(AbstractMessageListenerContainer.java:696) ~[spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:605) ~[spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:308) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:246) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1137) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1129) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1031) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at java.lang.Thread.run(Thread.java:745) [na:1.8.0_40]
15:46:34 [scoreMessageJmsContainer-1] WARN  o.s.j.l.DefaultMessageListenerContainer - Setup of JMS message listener invoker failed for destination 'queue://scoreMessageQueue' - trying to recover. Cause: The Session is closed
15:46:34 [defaultCouponMessageJmsContainer-1] INFO  c.m.c.m.PromotionMessageListener - cost: 116510ms promotionMessage: PromotionMessage(cityId=null, warehouseId=null, restaurantId=null, customerId=null, orderId=null, promotionType=null, couponId=null, couponSenderEnum=GATHERING_COMPLETED_SEND, stockOutIds=[55114])
15:46:34 [defaultCouponMessageJmsContainer-1] WARN  o.s.j.l.DefaultMessageListenerContainer - Execution of JMS message listener failed, and no ErrorHandler has been set.
javax.jms.IllegalStateException: The Session is closed
	at org.apache.activemq.ActiveMQSession.checkClosed(ActiveMQSession.java:767) ~[activemq-client-5.10.0.jar:5.10.0]
	at org.apache.activemq.ActiveMQSession.getTransacted(ActiveMQSession.java:532) ~[activemq-client-5.10.0.jar:5.10.0]
	at sun.reflect.GeneratedMethodAccessor31.invoke(Unknown Source) ~[na:na]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_40]
	at java.lang.reflect.Method.invoke(Method.java:497) ~[na:1.8.0_40]
	at org.springframework.jms.connection.CachingConnectionFactory$CachedSessionInvocationHandler.invoke(CachingConnectionFactory.java:384) ~[spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at com.sun.proxy.$Proxy153.getTransacted(Unknown Source) ~[na:na]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.commitIfNecessary(AbstractMessageListenerContainer.java:696) ~[spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:605) ~[spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:308) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:246) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1137) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1129) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1031) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at java.lang.Thread.run(Thread.java:745) [na:1.8.0_40]
15:46:34 [defaultCouponMessageJmsContainer-1] WARN  o.s.j.l.DefaultMessageListenerContainer - Setup of JMS message listener invoker failed for destination 'queue://defaultCouponMessageQueue' - trying to recover. Cause: The Session is closed
15:49:15 [defaultCouponMessageJmsContainer-1] ERROR c.m.c.m.PromotionMessageListener - promotionMessage: PromotionMessage(cityId=null, warehouseId=null, restaurantId=null, customerId=null, orderId=null, promotionType=null, couponId=null, couponSenderEnum=GATHERING_COMPLETED_SEND, stockOutIds=[55115]) errorMessage: java.lang.NullPointerException
java.lang.RuntimeException: java.lang.NullPointerException
	at com.mishu.cgwy.coupon.CouponUtils.getRealRule(CouponUtils.java:23) ~[classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$7.apply(CouponService.java:786) ~[classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$7.apply(CouponService.java:778) ~[classes/:na]
	at com.google.common.collect.Iterators$7.computeNext(Iterators.java:647) ~[guava-17.0.jar:na]
	at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:143) ~[guava-17.0.jar:na]
	at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:138) ~[guava-17.0.jar:na]
	at com.google.common.collect.Iterators.addAll(Iterators.java:356) ~[guava-17.0.jar:na]
	at com.google.common.collect.Lists.newArrayList(Lists.java:147) ~[guava-17.0.jar:na]
	at com.google.common.collect.Collections2$FilteredCollection.toArray(Collections2.java:217) ~[guava-17.0.jar:na]
	at java.util.ArrayList.<init>(ArrayList.java:177) ~[na:1.8.0_40]
	at com.mishu.cgwy.coupon.service.CouponService.getAvailableOrderGift(CouponService.java:777) ~[classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$$FastClassBySpringCGLIB$$e2708dbf.invoke(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:717) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:281) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:653) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.coupon.service.CouponService$$EnhancerBySpringCGLIB$$f707f644.getAvailableOrderGift(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.CompleteOrderCouponSender.send(CompleteOrderCouponSender.java:38) ~[classes/:na]
	at com.mishu.cgwy.message.CompleteOrderCouponSender$$FastClassBySpringCGLIB$$13959e18.invoke(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:649) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.message.CompleteOrderCouponSender$$EnhancerBySpringCGLIB$$fd5bfc7d.send(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender.send(GatheringCompletedCouponSender.java:26) ~[classes/:na]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender$$FastClassBySpringCGLIB$$25e7ed37.invoke(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:717) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:281) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:653) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender$$EnhancerBySpringCGLIB$$3df79ebc.send(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.PromotionMessageListener.onMessage(PromotionMessageListener.java:25) ~[classes/:na]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:685) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:623) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:591) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:308) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:246) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1137) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1129) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1031) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at java.lang.Thread.run(Thread.java:745) [na:1.8.0_40]
Caused by: java.lang.NullPointerException: null
	at com.mishu.cgwy.coupon.CouponUtils.getRealRule(CouponUtils.java:20) ~[classes/:na]
	... 46 common frames omitted
15:50:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant add constraint FK_9xujac7ov11xmaijj1y43ypq7 foreign key (type_id) references restaurant_type (id)
15:50:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:50:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant_type add constraint FK_7jxspfd0tyuhs68nc15gp2qdb foreign key (parent_id) references restaurant_type (id)
15:50:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:50:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant_type_city_xref add constraint FK_c2nechb3ltahd2705tdmjjpwu foreign key (restaurant_type_id) references restaurant_type (id)
15:50:10 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:50:14 [main] INFO  c.m.cgwy.message.MessageConsumer - Application started successfully.
15:51:13 [defaultCouponMessageJmsContainer-1] ERROR c.m.c.m.PromotionMessageListener - promotionMessage: PromotionMessage(cityId=null, warehouseId=null, restaurantId=null, customerId=null, orderId=null, promotionType=null, couponId=null, couponSenderEnum=GATHERING_COMPLETED_SEND, stockOutIds=[55117]) errorMessage: java.lang.NullPointerException
java.lang.RuntimeException: java.lang.NullPointerException
	at com.mishu.cgwy.coupon.CouponUtils.getRealRule(CouponUtils.java:23) ~[classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$7.apply(CouponService.java:786) ~[classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$7.apply(CouponService.java:778) ~[classes/:na]
	at com.google.common.collect.Iterators$7.computeNext(Iterators.java:647) ~[guava-17.0.jar:na]
	at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:143) ~[guava-17.0.jar:na]
	at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:138) ~[guava-17.0.jar:na]
	at com.google.common.collect.Iterators.addAll(Iterators.java:356) ~[guava-17.0.jar:na]
	at com.google.common.collect.Lists.newArrayList(Lists.java:147) ~[guava-17.0.jar:na]
	at com.google.common.collect.Collections2$FilteredCollection.toArray(Collections2.java:217) ~[guava-17.0.jar:na]
	at java.util.ArrayList.<init>(ArrayList.java:177) ~[na:1.8.0_40]
	at com.mishu.cgwy.coupon.service.CouponService.getAvailableOrderGift(CouponService.java:777) ~[classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$$FastClassBySpringCGLIB$$e2708dbf.invoke(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:717) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:281) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:653) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.coupon.service.CouponService$$EnhancerBySpringCGLIB$$f707f644.getAvailableOrderGift(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.CompleteOrderCouponSender.send(CompleteOrderCouponSender.java:38) ~[classes/:na]
	at com.mishu.cgwy.message.CompleteOrderCouponSender$$FastClassBySpringCGLIB$$13959e18.invoke(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:649) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.message.CompleteOrderCouponSender$$EnhancerBySpringCGLIB$$fd5bfc7d.send(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender.send(GatheringCompletedCouponSender.java:26) ~[classes/:na]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender$$FastClassBySpringCGLIB$$25e7ed37.invoke(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:717) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:281) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:653) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender$$EnhancerBySpringCGLIB$$3df79ebc.send(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.PromotionMessageListener.onMessage(PromotionMessageListener.java:25) ~[classes/:na]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:685) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:623) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:591) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:308) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:246) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1137) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1129) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1031) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at java.lang.Thread.run(Thread.java:745) [na:1.8.0_40]
Caused by: java.lang.NullPointerException: null
	at com.mishu.cgwy.coupon.CouponUtils.getRealRule(CouponUtils.java:20) ~[classes/:na]
	... 46 common frames omitted
15:53:19 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant add constraint FK_9xujac7ov11xmaijj1y43ypq7 foreign key (type_id) references restaurant_type (id)
15:53:19 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:53:19 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant_type add constraint FK_7jxspfd0tyuhs68nc15gp2qdb foreign key (parent_id) references restaurant_type (id)
15:53:19 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:53:19 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - HHH000388: Unsuccessful: alter table restaurant_type_city_xref add constraint FK_c2nechb3ltahd2705tdmjjpwu foreign key (restaurant_type_id) references restaurant_type (id)
15:53:19 [main] ERROR o.h.tool.hbm2ddl.SchemaUpdate - Cannot add foreign key constraint
15:53:24 [main] INFO  c.m.cgwy.message.MessageConsumer - Application started successfully.
15:57:02 [defaultCouponMessageJmsContainer-1] ERROR c.m.c.m.PromotionMessageListener - promotionMessage: PromotionMessage(cityId=null, warehouseId=null, restaurantId=null, customerId=null, orderId=null, promotionType=null, couponId=null, couponSenderEnum=GATHERING_COMPLETED_SEND, stockOutIds=[55118]) errorMessage: java.lang.NullPointerException
java.lang.RuntimeException: java.lang.NullPointerException
	at com.mishu.cgwy.coupon.CouponUtils.getRealRule(CouponUtils.java:23) ~[classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$7.apply(CouponService.java:786) ~[classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$7.apply(CouponService.java:778) ~[classes/:na]
	at com.google.common.collect.Iterators$7.computeNext(Iterators.java:647) ~[guava-17.0.jar:na]
	at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:143) ~[guava-17.0.jar:na]
	at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:138) ~[guava-17.0.jar:na]
	at com.google.common.collect.Iterators.addAll(Iterators.java:356) ~[guava-17.0.jar:na]
	at com.google.common.collect.Lists.newArrayList(Lists.java:147) ~[guava-17.0.jar:na]
	at com.google.common.collect.Collections2$FilteredCollection.toArray(Collections2.java:217) ~[guava-17.0.jar:na]
	at java.util.ArrayList.<init>(ArrayList.java:177) ~[na:1.8.0_40]
	at com.mishu.cgwy.coupon.service.CouponService.getAvailableOrderGift(CouponService.java:777) ~[classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$$FastClassBySpringCGLIB$$e2708dbf.invoke(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:717) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:281) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:653) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.coupon.service.CouponService$$EnhancerBySpringCGLIB$$e13f3c9c.getAvailableOrderGift(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.CompleteOrderCouponSender.send(CompleteOrderCouponSender.java:38) ~[classes/:na]
	at com.mishu.cgwy.message.CompleteOrderCouponSender$$FastClassBySpringCGLIB$$13959e18.invoke(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:649) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.message.CompleteOrderCouponSender$$EnhancerBySpringCGLIB$$e79342d5.send(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender.send(GatheringCompletedCouponSender.java:26) ~[classes/:na]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender$$FastClassBySpringCGLIB$$25e7ed37.invoke(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:717) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:281) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96) ~[spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:653) ~[spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender$$EnhancerBySpringCGLIB$$282ee514.send(<generated>) ~[spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.PromotionMessageListener.onMessage(PromotionMessageListener.java:25) ~[classes/:na]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:685) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:623) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:591) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:308) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:246) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1137) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1129) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1031) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at java.lang.Thread.run(Thread.java:745) [na:1.8.0_40]
Caused by: java.lang.NullPointerException: null
	at com.mishu.cgwy.coupon.CouponUtils.getRealRule(CouponUtils.java:20) ~[classes/:na]
	... 46 common frames omitted
16:01:18 [defaultCouponMessageJmsContainer-1] ERROR c.m.c.coupon.service.CouponService - Unable to parse and/or execute an mvel expression. Reporting to the logs and returning false for the match expression:OrderService.getOrderAmountByCategories(order,[Ljava.lang.Long;@73aa45b3)>=100&&OrderService.getOrderAmountByCategories(order,[Ljava.lang.Long;@73aa45b3)<4000&&city.id==1&&warehouse.id==1
org.mvel2.CompileException: [Error: unbalanced braces [ ... ]]
[Near : {... ,[Ljava.lang.Long;@73aa45b3)>=100&&OrderService.ge ....}]
                                                                             ^
[Line: 1, Column: 66]
	at org.mvel2.util.ParseTools.balancedCapture(ParseTools.java:1343) ~[mvel2-2.2.4.Final.jar:na]
	at org.mvel2.util.ParseTools.balancedCapture(ParseTools.java:1277) ~[mvel2-2.2.4.Final.jar:na]
	at org.mvel2.util.ParseTools.parseParameterList(ParseTools.java:195) ~[mvel2-2.2.4.Final.jar:na]
	at org.mvel2.compiler.PropertyVerifier.getMethod(PropertyVerifier.java:503) ~[mvel2-2.2.4.Final.jar:na]
	at org.mvel2.compiler.PropertyVerifier.analyze(PropertyVerifier.java:120) ~[mvel2-2.2.4.Final.jar:na]
	at org.mvel2.compiler.ExpressionCompiler.verify(ExpressionCompiler.java:384) ~[mvel2-2.2.4.Final.jar:na]
	at org.mvel2.compiler.ExpressionCompiler._compile(ExpressionCompiler.java:277) ~[mvel2-2.2.4.Final.jar:na]
	at org.mvel2.compiler.ExpressionCompiler.compile(ExpressionCompiler.java:63) ~[mvel2-2.2.4.Final.jar:na]
	at org.mvel2.MVEL.compileExpression(MVEL.java:810) ~[mvel2-2.2.4.Final.jar:na]
	at com.mishu.cgwy.utils.ExpressionUtils.executeExpression(ExpressionUtils.java:38) ~[classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$7.apply(CouponService.java:786) [classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$7.apply(CouponService.java:778) [classes/:na]
	at com.google.common.collect.Iterators$7.computeNext(Iterators.java:647) [guava-17.0.jar:na]
	at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:143) [guava-17.0.jar:na]
	at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:138) [guava-17.0.jar:na]
	at com.google.common.collect.Iterators.addAll(Iterators.java:356) [guava-17.0.jar:na]
	at com.google.common.collect.Lists.newArrayList(Lists.java:147) [guava-17.0.jar:na]
	at com.google.common.collect.Collections2$FilteredCollection.toArray(Collections2.java:217) [guava-17.0.jar:na]
	at java.util.ArrayList.<init>(ArrayList.java:177) [na:1.8.0_40]
	at com.mishu.cgwy.coupon.service.CouponService.getAvailableOrderGift(CouponService.java:777) [classes/:na]
	at com.mishu.cgwy.coupon.service.CouponService$$FastClassBySpringCGLIB$$e2708dbf.invoke(<generated>) [spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) [spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:717) [spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157) [spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99) [spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:281) [spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96) [spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) [spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:653) [spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.coupon.service.CouponService$$EnhancerBySpringCGLIB$$e13f3c9c.getAvailableOrderGift(<generated>) [spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.CompleteOrderCouponSender.send(CompleteOrderCouponSender.java:38) [classes/:na]
	at com.mishu.cgwy.message.CompleteOrderCouponSender$$FastClassBySpringCGLIB$$13959e18.invoke(<generated>) [spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) [spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:649) [spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.message.CompleteOrderCouponSender$$EnhancerBySpringCGLIB$$e79342d5.send(<generated>) [spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender.send(GatheringCompletedCouponSender.java:26) [classes/:na]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender$$FastClassBySpringCGLIB$$25e7ed37.invoke(<generated>) [spring-core-4.1.5.RELEASE.jar:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) [spring-core-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:717) [spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157) [spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99) [spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:281) [spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96) [spring-tx-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) [spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:653) [spring-aop-4.1.5.RELEASE.jar:4.1.5.RELEASE]
	at com.mishu.cgwy.message.GatheringCompletedCouponSender$$EnhancerBySpringCGLIB$$282ee514.send(<generated>) [spring-core-4.1.5.RELEASE.jar:na]
	at com.mishu.cgwy.message.PromotionMessageListener.onMessage(PromotionMessageListener.java:25) [classes/:na]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:685) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:623) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:591) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:308) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:246) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1137) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1129) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1031) [spring-jms-4.1.0.RELEASE.jar:4.1.0.RELEASE]
	at java.lang.Thread.run(Thread.java:745) [na:1.8.0_40]
16:01:18 [defaultCouponMessageJmsContainer-1] INFO  c.m.c.m.PromotionMessageListener - cost: 58996ms promotionMessage: PromotionMessage(cityId=null, warehouseId=null, restaurantId=null, customerId=null, orderId=null, promotionType=null, couponId=null, couponSenderEnum=GATHERING_COMPLETED_SEND, stockOutIds=[55119])
16:15:01 [defaultCouponMessageJmsContainer-1] INFO  c.m.cgwy.order.service.OrderService - subTotalMapByCategory:{1=1950.00, -2=1950.00, 358=1950.00, 493=1950.00}
16:15:01 [defaultCouponMessageJmsContainer-1] INFO  c.m.cgwy.order.service.OrderService - categoryIds:{-2}
16:15:01 [defaultCouponMessageJmsContainer-1] INFO  c.m.cgwy.order.service.OrderService - subTotalByCategories:1950.00
16:15:01 [defaultCouponMessageJmsContainer-1] INFO  c.m.cgwy.order.service.OrderService - subTotalMapByCategory:{1=1950.00, -2=1950.00, 358=1950.00, 493=1950.00}
16:15:01 [defaultCouponMessageJmsContainer-1] INFO  c.m.cgwy.order.service.OrderService - categoryIds:{-2}
16:15:01 [defaultCouponMessageJmsContainer-1] INFO  c.m.cgwy.order.service.OrderService - subTotalByCategories:1950.00
16:15:01 [defaultCouponMessageJmsContainer-1] INFO  c.m.c.m.PromotionMessageListener - cost: 39320ms promotionMessage: PromotionMessage(cityId=null, warehouseId=null, restaurantId=null, customerId=null, orderId=null, promotionType=null, couponId=null, couponSenderEnum=GATHERING_COMPLETED_SEND, stockOutIds=[55120])
